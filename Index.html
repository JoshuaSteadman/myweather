<input type="text" id="searchInput" placeholder="Search for MP3s on archive.org">
<button id="searchButton">Search</button>
<div id="results"></div>

<script>
const searchInput = document.getElementById('searchInput');
const searchButton = document.getElementById('searchButton');
const resultsDiv = document.getElementById('results');

searchButton.addEventListener('click', performSearch);

function performSearch() {
  const query = searchInput.value;
  const url = `https://archive.org/advancedsearch.php?q=${encodeURIComponent(query)}&output=json`;

  fetch(url)
    .then(response => response.json())
    .then(data => {
      displayResults(data.response.docs);
    })
    .catch(error => {
      console.error('Error:', error);
      resultsDiv.innerHTML = 'An error occurred while searching.';
    });
}

function displayResults(items) {
  resultsDiv.innerHTML = '';
  items.forEach(item => {
    const itemDiv = document.createElement('div');
    itemDiv.innerHTML = `
      <h3>${item.title}</h3>
      <p>${item.description}</p>
      <a href="https://archive.org/download/${item.identifier}" target="_blank">View Downloads</a>
      <button onclick="extractMp3Links('${item.identifier}')">Extract MP3 Links</button>
    `;
    resultsDiv.appendChild(itemDiv);
  });
}

function extractMp3Links(identifier) {
  const url = `https://archive.org/download/${identifier}`;
  
  fetch(url)
    .then(response => response.text())
    .then(html => {
      const parser = new DOMParser();
      const doc = parser.parseFromString(html, 'text/html');
      const links = doc.querySelectorAll('a[href$=".mp3"]');
      const mp3Links = Array.from(links).map(link => url + '/' + link.getAttribute('href'));
      
      displayMp3Links(mp3Links);
    })
    .catch(error => {
      console.error('Error:', error);
      alert('An error occurred while extracting MP3 links.');
    });
}

function displayMp3Links(links) {
  const linksDiv = document.createElement('div');
  linksDiv.innerHTML = '<h4>MP3 Links:</h4>';
  links.forEach(link => {
    const linkElement = document.createElement('a');
    linkElement.href = link;
    linkElement.textContent = link.split('/').pop();
    linkElement.target = '_blank';
    linksDiv.appendChild(linkElement);
    linksDiv.appendChild(document.createElement('br'));
  });
  
  resultsDiv.appendChild(linksDiv);
}
</script>
